<!DOCTYPE html>
<html>
<head>
    <title>å°åŒ—æ·é‹å¤œå¸‚åœ°åœ–</title>
    <style>
        /* åŸºæœ¬è¨­å®š */
        body { margin: 0; }
        #map { height: 100vh; width: 100%; }

        /* ç§»é™¤é€£çµé è¨­æ¨£å¼ */
        .info-link { text-decoration: none; color: inherit; }

        /* è‡ªè¨‚å¤œå¸‚è³‡è¨Šæ¨™ç±¤çš„æ¨£å¼ */
        .info-label { background-color: white; padding: 10px; border: 1px solid #ccc; border-top: 4px solid #ccc; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); font-size: 14px; line-height: 1.5; transform: translateX(15px) translateY(-110%); white-space: nowrap; cursor: pointer; transition: transform 0.1s ease-in-out, background-color 0.1s ease-in-out; }
        .info-label:hover { background-color: #f5f5f5; transform: translateX(15px) translateY(-110%) scale(1.03); }
        .info-label .name { font-size: 16px; font-weight: bold; display: flex; align-items: center; }
        .pin-icon { width: 16px; height: 16px; margin-right: 6px; fill: #E3002C; }

        /* æµ®å‹•è³‡è¨Šæ¬„ä½çš„é€šç”¨æ¨£å¼*/
        .floating-panel {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            z-index: 5; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
            font-family: 'Helvetica Neue', 'Arial', 'sans-serif';
        }

        /* å³ä¸Šè§’æ¨™é¡Œæ¨£å¼ */
        #map-title {
            top: 10px;
            right: 10px;
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        /* å³ä¸‹è§’åœ–ä¾‹æ¨£å¼ */
        #map-legend {
            bottom: 10px;
            right: 10px;
        }
        #map-legend ul {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        #map-legend li {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 14px;
        }
        #map-legend li:last-child {
            margin-bottom: 0;
        }
        .legend-color {
            width: 30px; /* æ‹‰é•·è‰²å¡Šä»¥æ¨¡ä»¿åŸåœ– */
            height: 15px;
            margin-right: 10px;
            border-radius: 3px;
            border: 1px solid rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- åœ°åœ–å®¹å™¨ -->
    <div id="map"></div>

    <!-- æ–°å¢ï¼šæµ®å‹•è³‡è¨Šæ¬„ä½ -->
    <div id="map-title" class="floating-panel">
        å°åŒ—æ·é‹ å¤œå¸‚åœ°åœ–
    </div>

    <div id="map-legend" class="floating-panel">
        <ul>
            <li><span class="legend-color" style="background-color: #C48A31;"></span> BR æ–‡æ¹–ç·š</li>
            <li><span class="legend-color" style="background-color: #E3002C;"></span> R æ·¡æ°´ä¿¡ç¾©ç·š</li>
            <li><span class="legend-color" style="background-color: #008659;"></span> G æ¾å±±æ–°åº—ç·š</li>
            <li><span class="legend-color" style="background-color: #F8B61C;"></span> O ä¸­å’Œæ–°è˜†ç·š</li>
            <li><span class="legend-color" style="background-color: #0070BD;"></span> BL æ¿å—ç·š</li>
            <li><span class="legend-color" style="background-color: #FFDB00;"></span> Y ç’°ç‹€ç·š</li>
        </ul>
    </div>


    <script>
        const mrtLineColors = { "G": "#008659", "R": "#E3002C", "BL": "#0070BD", "O": "#F8B61C", "BR": "#C48A31", "Y": "#FFDB00" };
        const nightMarkets = [ /* Night market data here */ ];
        const pinIconSVG = `<svg class="pin-icon" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>`;
        function initMap() {
            const map = new google.maps.Map(document.getElementById("map"), {});
            const bounds = new google.maps.LatLngBounds();
            class CustomLabel extends google.maps.OverlayView { constructor(position, content) { super(); this.position = position; this.content = content; this.div = null; } onAdd() { this.div = document.createElement("div"); this.div.style.position = "absolute"; this.div.innerHTML = this.content; this.getPanes().floatPane.appendChild(this.div); } draw() { const point = this.getProjection().fromLatLngToDivPixel(this.position); if (point) { this.div.style.left = `${point.x}px`; this.div.style.top = `${point.y}px`; } } onRemove() { if (this.div) { this.div.parentNode.removeChild(this.div); this.div = null; } } }
            nightMarkets.forEach(market => {
                const position = new google.maps.LatLng(market.coords.lat, market.coords.lng);
                const searchUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(market.name + " " + market.coords.lat + "," + market.coords.lng)}`;
                let borderStyle = '', nameColorStyle = '';
                const lineCodes = market.station.match(/[A-Z]{1,2}/g) || [];
                const colors = lineCodes.map(code => mrtLineColors[code]).filter(Boolean);
                if (colors.length === 1) { borderStyle = `border-top: 4px solid ${colors[0]};`; nameColorStyle = `color: ${colors[0]};`; } else if (colors.length > 1) { const gradientStops = colors.map((color, index, arr) => `${color} ${index * 100 / arr.length}%, ${color} ${(index + 1) * 100 / arr.length}%`).join(', '); borderStyle = `border-top: 4px solid transparent; border-image: linear-gradient(to right, ${gradientStops}) 1;`; nameColorStyle = `color: #555;`; }
                const labelContent = `<a href="${searchUrl}" target="_blank" class="info-link"><div class="info-label" style="${borderStyle}"><div class="name" style="${nameColorStyle}">${pinIconSVG}<span>${market.name}</span></div><span>æ·é‹: ${market.station}</span></div></a>`;
                new CustomLabel(position, labelContent).setMap(map);
                bounds.extend(position);
            });
            map.fitBounds(bounds);
        }
        
        nightMarkets.push(
            { name: "é¥’æ²³è¡—å¤œå¸‚", coords: { lat: 25.0509, lng: 121.5771 }, station: "æ¾å±±ç«™ (G19)" },
            { name: "å£«æ—å¤œå¸‚", coords: { lat: 25.0889, lng: 121.5244 }, station: "åŠæ½­ç«™ (R15)" },
            { name: "å¯§å¤å¤œå¸‚", coords: { lat: 25.0565, lng: 121.5154 }, station: "é›™é€£ç«™ (R12)" },
            { name: "è‡¨æ±Ÿè¡—å¤œå¸‚", coords: { lat: 25.0326, lng: 121.5546 }, station: "ä¿¡ç¾©å®‰å’Œç«™ (R04)" },
            { name: "å¸«å¤§é¾æ³‰å•†åœˆ", coords: { lat: 25.0255, lng: 121.5288 }, station: "å°é›»å¤§æ¨“ç«™ (G08)" },
            { name: "è¯è¥¿è¡—å¤œå¸‚", coords: { lat: 25.0381, lng: 121.4988 }, station: "é¾å±±å¯ºç«™ (BL10)"},
            { name: "è‰‹èˆºå¤œå¸‚", coords: { lat: 25.0384, lng: 121.5000 }, station: "é¾å±±å¯ºç«™ (BL10)"},
            { name: "å—æ©Ÿå ´å¤œå¸‚", coords: { lat: 25.0303, lng: 121.5055 }, station: "å°å—é–€ç«™ (G12)" },
            { name: "æ¨‚è¯å¤œå¸‚", coords: { lat: 25.0101, lng: 121.5140 }, station: "é ‚æºªç«™ (O04)" },
            { name: "å…¬é¤¨å¤œå¸‚", coords: { lat: 25.0152, lng: 121.5342 }, station: "å…¬é¤¨ç«™ (G07)" },
            { name: "æ™¯ç¾å¤œå¸‚", coords: { lat: 24.9930, lng: 121.5407 }, station: "æ™¯ç¾ç«™ (G05)" },
            { name: "å»¶ä¸‰å¤œå¸‚", coords: { lat: 25.0594, lng: 121.5113 }, station: "å¤§æ©‹é ­ç«™ (O12)" },
            { name: "æ¹³é›…å¤œå¸‚", coords: { lat: 25.0044, lng: 121.4580 }, station: "åºœä¸­ç«™ (BL06)" },
            { name: "é¼å¯§è¡—å¤œå¸‚", coords: { lat: 25.0500, lng: 121.5413 }, station: "å—äº¬å¾©èˆˆç«™ (G16/BR11)"},
            { name: "é›™åŸè¡—å¤œå¸‚", coords: { lat: 25.0645, lng: 121.5238 }, station: "ä¸­å±±åœ‹å°ç«™ (O10)"},
            { name: "737å··å¤œå¸‚", coords: { lat: 25.0740, lng: 121.5815 }, station: "æ¸¯å¢˜ç«™ (BR18)" },
            { name: "æ–°èŠå»Ÿè¡—å¤œå¸‚", coords: { lat: 25.0355, lng: 121.4520 }, station: "æ–°èŠç«™ (O18)" },
            { name: "çŸ³ç‰Œå•†åŸå¤œå¸‚", coords: { lat: 25.1147, lng: 121.5168 }, station: "çŸ³ç‰Œç«™ (R19)" },
            { name: "ä¸‰å’Œå¤œå¸‚", coords: { lat: 25.0645, lng: 121.4983 }, station: "ä¸‰é‡åœ‹å°ç«™ (O13)" },
            { name: "è˜†æ´²å»Ÿå£å¤œå¸‚", coords: { lat: 25.0833, lng: 121.4720 }, station: "ä¸‰æ°‘é«˜ä¸­ç«™ (O52)" },
            { name: "èˆˆå—å¤œå¸‚", coords: { lat: 24.9868, lng: 121.5100 }, station: "å—å‹¢è§’ç«™ (O01)"},
            { name: "å³èˆˆè¡—å•†åœˆ", coords: { lat: 25.0298, lng: 121.5658 }, station: "å°åŒ—101/ä¸–è²¿ç«™ (R03)" }
        );

    </script>

    <!-- å˜—è©¦è¼‰å…¥æœ¬åœ°é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ -->
    <script>
        // å‹•æ…‹è¼‰å…¥ config.jsï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        function loadConfig() {
            return new Promise((resolve) => {
                const script = document.createElement('script');
                script.src = 'config.js';
                script.onload = () => {
                    console.log('âœ… config.js è¼‰å…¥æˆåŠŸ');
                    resolve(true);
                };
                script.onerror = () => {
                    console.log('ğŸ“ config.js ä¸å­˜åœ¨ï¼Œä½¿ç”¨å…¶ä»–é…ç½®æ–¹æ³•');
                    resolve(false);
                };
                document.head.appendChild(script);
            });
        }

        // è¼‰å…¥ç’°å¢ƒè®Šæ•¸è¼‰å…¥å™¨
        function loadEnvLoader() {
            return new Promise((resolve) => {
                const script = document.createElement('script');
                script.src = 'env-loader.js';
                script.onload = resolve;
                script.onerror = resolve;
                document.head.appendChild(script);
            });
        }

        // æŒ‰é †åºè¼‰å…¥é…ç½®
        async function initializeConfig() {
            await loadConfig();
            await loadEnvLoader();
            loadGoogleMapsAPI();
        }
    </script>

    <!-- å‹•æ…‹è¼‰å…¥ Google Maps JavaScript API -->
    <script>
        // å‹•æ…‹è¼‰å…¥ Google Maps API
        function loadGoogleMapsAPI() {
            if (!CONFIG.GOOGLE_MAPS_API_KEY || CONFIG.GOOGLE_MAPS_API_KEY === 'YOUR_LOCAL_DEV_API_KEY') {
                console.error('âŒ Google Maps API Key æœªæ­£ç¢ºè¨­å®š');
                document.getElementById('map').innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #f5f5f5; font-family: Arial, sans-serif;">
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <h2>ğŸ—ºï¸ Google Maps API Key æœªè¨­å®š</h2>
                            <p>è«‹è¨­å®šæ‚¨çš„ Google Maps API Keyï¼š</p>
                            <ol style="text-align: left; margin: 20px 0;">
                                <li>ç·¨è¼¯ <code>env-loader.js</code> æ–‡ä»¶</li>
                                <li>å°‡ <code>YOUR_LOCAL_DEV_API_KEY</code> æ›¿æ›ç‚ºæ‚¨çš„å¯¦éš› API Key</li>
                                <li>æˆ–åœ¨ URL ä¸­åŠ å…¥ <code>?apikey=YOUR_API_KEY</code></li>
                            </ol>
                            <p><small>å¦‚ä½•ç²å– API Keyï¼š<a href="https://developers.google.com/maps/documentation/javascript/get-api-key" target="_blank">Google Maps API æ–‡æª”</a></small></p>
                        </div>
                    </div>
                `;
                return;
            }

            const script = document.createElement('script');
            script.async = true;
            script.defer = true;
            script.src = `https://maps.googleapis.com/maps/api/js?key=${CONFIG.GOOGLE_MAPS_API_KEY}&callback=initMap`;
            script.onerror = function() {
                console.error('âŒ Google Maps API è¼‰å…¥å¤±æ•—');
                document.getElementById('map').innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #f5f5f5; font-family: Arial, sans-serif;">
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <h2>âŒ Google Maps API è¼‰å…¥å¤±æ•—</h2>
                            <p>è«‹æª¢æŸ¥ï¼š</p>
                            <ul style="text-align: left; margin: 20px 0;">
                                <li>API Key æ˜¯å¦æ­£ç¢º</li>
                                <li>æ˜¯å¦å·²å•Ÿç”¨ Maps JavaScript API</li>
                                <li>API Key æ˜¯å¦æœ‰ä½¿ç”¨é™åˆ¶</li>
                                <li>ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸</li>
                            </ul>
                        </div>
                    </div>
                `;
            };
            document.head.appendChild(script);
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–é…ç½®
        document.addEventListener('DOMContentLoaded', initializeConfig);
    </script>
</body>
</html>
